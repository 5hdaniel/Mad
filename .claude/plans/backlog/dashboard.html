<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backlog Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .generated-at {
            opacity: 0.8;
            font-size: 0.9em;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .metric-card.warning {
            border-left: 4px solid #f59e0b;
        }

        .metric-card.danger {
            border-left: 4px solid #ef4444;
        }

        .metric-card.success {
            border-left: 4px solid #10b981;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin-bottom: 15px;
            color: #444;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }

        .filter-group select, .filter-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
            min-width: 150px;
        }

        .filter-group input[type="text"] {
            min-width: 250px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd6;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #333;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            color: #444;
        }

        .result-count {
            color: #666;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #e9ecef;
        }

        th.sorted-asc::after {
            content: ' ‚ñ≤';
        }

        th.sorted-desc::after {
            content: ' ‚ñº';
        }

        tr:hover {
            background: #f8f9fa;
        }

        .priority-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .priority-critical {
            background: #fee2e2;
            color: #dc2626;
        }

        .priority-high {
            background: #fef3c7;
            color: #d97706;
        }

        .priority-medium {
            background: #dbeafe;
            color: #2563eb;
        }

        .priority-low {
            background: #e5e7eb;
            color: #6b7280;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-pending {
            background: #e0e7ff;
            color: #4338ca;
        }

        .status-in-progress {
            background: #fef3c7;
            color: #d97706;
        }

        .status-testing {
            background: #d1fae5;
            color: #059669;
        }

        .status-completed {
            background: #d1fae5;
            color: #059669;
        }

        .status-blocked {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-reopened {
            background: #fce7f3;
            color: #db2777;
        }

        .status-obsolete {
            background: #e5e7eb;
            color: #6b7280;
        }

        .attention-section {
            margin-bottom: 30px;
        }

        .attention-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .attention-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .attention-card h4 {
            color: #ef4444;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attention-card ul {
            list-style: none;
            font-size: 0.9em;
        }

        .attention-card li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .attention-card li:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group select, .filter-group input {
                width: 100%;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Backlog Dashboard</h1>
            <p class="generated-at">Generated: <span id="generated-time"></span></p>
        </header>

        <div class="metrics-grid" id="metrics-grid">
            <!-- Metrics will be inserted here -->
        </div>

        <div class="attention-section" id="attention-section">
            <!-- Attention cards will be inserted here -->
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Status Distribution</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Priority Distribution (Open Items)</h3>
                <canvas id="priorityChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Category Distribution (Top 10)</h3>
                <canvas id="categoryChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Effort Distribution</h3>
                <canvas id="effortChart"></canvas>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>Search</label>
                <input type="text" id="searchInput" placeholder="Search by ID or title...">
            </div>
            <div class="filter-group">
                <label>Status</label>
                <select id="statusFilter">
                    <option value="">All Statuses</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Priority</label>
                <select id="priorityFilter">
                    <option value="">All Priorities</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Category</label>
                <select id="categoryFilter">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Sprint</label>
                <select id="sprintFilter">
                    <option value="">All Sprints</option>
                    <option value="unassigned">Unassigned</option>
                </select>
            </div>
            <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3>Backlog Items</h3>
                <span class="result-count" id="resultCount"></span>
            </div>
            <table id="backlogTable">
                <thead>
                    <tr>
                        <th data-sort="id">ID</th>
                        <th data-sort="title">Title</th>
                        <th data-sort="category">Category</th>
                        <th data-sort="priority">Priority</th>
                        <th data-sort="status">Status</th>
                        <th data-sort="sprint">Sprint</th>
                        <th data-sort="est_tokens">Estimate</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Backlog data will be injected here
        const backlogData = BACKLOG_DATA_PLACEHOLDER;

        let currentSort = { column: 'id', direction: 'asc' };
        let filteredData = [...backlogData];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generated-time').textContent = new Date().toLocaleString();

            populateFilters();
            renderMetrics();
            renderAttentionSection();
            renderCharts();
            renderTable();

            // Event listeners
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('priorityFilter').addEventListener('change', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('sprintFilter').addEventListener('change', applyFilters);

            // Sort headers
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => sortTable(th.dataset.sort));
            });
        });

        function normalize(val) {
            return (val || '').toLowerCase().trim().replace(/\*/g, '').replace(/_/g, '');
        }

        function parseTokens(val) {
            if (!val || val === '-') return 0;
            val = val.replace(/~/g, '').replace(/,/g, '').toUpperCase().trim();
            if (val.includes('-') && !val.startsWith('-')) val = val.split('-')[0];
            if (val.includes('K')) return parseFloat(val.replace('K', '')) * 1000;
            if (val.includes('M')) return parseFloat(val.replace('M', '')) * 1000000;
            return parseInt(val) || 0;
        }

        function populateFilters() {
            const statuses = [...new Set(backlogData.map(i => normalize(i.status)))].sort();
            const priorities = ['critical', 'high', 'medium', 'low'];
            const categories = [...new Set(backlogData.map(i => normalize(i.category)))].sort();
            const sprints = [...new Set(backlogData.map(i => i.sprint).filter(s => s && s !== '-'))].sort();

            const statusSelect = document.getElementById('statusFilter');
            statuses.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                statusSelect.appendChild(opt);
            });

            const prioritySelect = document.getElementById('priorityFilter');
            priorities.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p;
                opt.textContent = p;
                prioritySelect.appendChild(opt);
            });

            const categorySelect = document.getElementById('categoryFilter');
            categories.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                categorySelect.appendChild(opt);
            });

            const sprintSelect = document.getElementById('sprintFilter');
            sprints.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                sprintSelect.appendChild(opt);
            });
        }

        function renderMetrics() {
            const closed = ['completed', 'obsolete'];
            const open = backlogData.filter(i => !closed.includes(normalize(i.status)));
            const completed = backlogData.filter(i => normalize(i.status) === 'completed');
            const highPriorityUnassigned = open.filter(i =>
                ['critical', 'high'].includes(normalize(i.priority)) &&
                (!i.sprint || i.sprint === '-')
            );
            const blocked = backlogData.filter(i => normalize(i.status) === 'blocked');
            const reopened = backlogData.filter(i => normalize(i.status) === 'reopened');

            const metrics = [
                { value: backlogData.length, label: 'Total Items', class: '' },
                { value: open.length, label: 'Open Items', class: '' },
                { value: completed.length, label: 'Completed', class: 'success' },
                { value: highPriorityUnassigned.length, label: 'High Priority Unassigned', class: highPriorityUnassigned.length > 10 ? 'warning' : '' },
                { value: blocked.length, label: 'Blocked', class: blocked.length > 0 ? 'danger' : '' },
                { value: reopened.length, label: 'Reopened', class: reopened.length > 0 ? 'danger' : '' },
            ];

            const grid = document.getElementById('metrics-grid');
            grid.innerHTML = metrics.map(m => `
                <div class="metric-card ${m.class}">
                    <div class="metric-value">${m.value}</div>
                    <div class="metric-label">${m.label}</div>
                </div>
            `).join('');
        }

        function renderAttentionSection() {
            const closed = ['completed', 'obsolete'];
            const open = backlogData.filter(i => !closed.includes(normalize(i.status)));

            const blocked = backlogData.filter(i => normalize(i.status) === 'blocked');
            const reopened = backlogData.filter(i => normalize(i.status) === 'reopened');
            const testing = backlogData.filter(i => normalize(i.status) === 'testing');

            const cards = [];

            if (blocked.length > 0) {
                cards.push({
                    title: 'üö´ Blocked Items',
                    items: blocked.map(i => `${i.id}: ${i.title.substring(0, 50)}`)
                });
            }

            if (reopened.length > 0) {
                cards.push({
                    title: 'üîÑ Reopened (Failed Testing)',
                    items: reopened.map(i => `${i.id}: ${i.title.substring(0, 50)}`)
                });
            }

            if (testing.length > 0) {
                cards.push({
                    title: 'üß™ Awaiting Verification',
                    items: testing.map(i => `${i.id}: ${i.title.substring(0, 50)}`)
                });
            }

            const section = document.getElementById('attention-section');
            if (cards.length === 0) {
                section.innerHTML = '';
                return;
            }

            section.innerHTML = `
                <div class="attention-cards">
                    ${cards.map(card => `
                        <div class="attention-card">
                            <h4>${card.title}</h4>
                            <ul>
                                ${card.items.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderCharts() {
            const closed = ['completed', 'obsolete'];
            const open = backlogData.filter(i => !closed.includes(normalize(i.status)));

            // Status Chart
            const statusCounts = {};
            backlogData.forEach(i => {
                const s = normalize(i.status);
                statusCounts[s] = (statusCounts[s] || 0) + 1;
            });

            new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: [
                            '#818cf8', '#34d399', '#94a3b8', '#fbbf24', '#f87171', '#f472b6', '#60a5fa', '#a78bfa'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });

            // Priority Chart (open only)
            const priorityOrder = ['critical', 'high', 'medium', 'low'];
            const priorityCounts = { critical: 0, high: 0, medium: 0, low: 0 };
            open.forEach(i => {
                const p = normalize(i.priority);
                if (priorityCounts.hasOwnProperty(p)) priorityCounts[p]++;
            });

            new Chart(document.getElementById('priorityChart'), {
                type: 'bar',
                data: {
                    labels: priorityOrder.map(p => p.charAt(0).toUpperCase() + p.slice(1)),
                    datasets: [{
                        label: 'Items',
                        data: priorityOrder.map(p => priorityCounts[p]),
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Category Chart
            const categoryCounts = {};
            open.forEach(i => {
                const c = normalize(i.category);
                categoryCounts[c] = (categoryCounts[c] || 0) + 1;
            });
            const topCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: topCategories.map(c => c[0]),
                    datasets: [{
                        label: 'Items',
                        data: topCategories.map(c => c[1]),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });

            // Effort Chart
            const effortBuckets = { 'Small (<20K)': 0, 'Medium (20-50K)': 0, 'Large (50-100K)': 0, 'XLarge (>100K)': 0 };
            open.forEach(i => {
                const tokens = parseTokens(i.est_tokens);
                if (tokens === 0) return;
                if (tokens < 20000) effortBuckets['Small (<20K)']++;
                else if (tokens < 50000) effortBuckets['Medium (20-50K)']++;
                else if (tokens < 100000) effortBuckets['Large (50-100K)']++;
                else effortBuckets['XLarge (>100K)']++;
            });

            new Chart(document.getElementById('effortChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(effortBuckets),
                    datasets: [{
                        data: Object.values(effortBuckets),
                        backgroundColor: ['#34d399', '#fbbf24', '#f97316', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const priority = document.getElementById('priorityFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const sprint = document.getElementById('sprintFilter').value;

            filteredData = backlogData.filter(item => {
                if (search && !item.id.toLowerCase().includes(search) && !item.title.toLowerCase().includes(search)) {
                    return false;
                }
                if (status && normalize(item.status) !== status) return false;
                if (priority && normalize(item.priority) !== priority) return false;
                if (category && normalize(item.category) !== category) return false;
                if (sprint === 'unassigned' && item.sprint && item.sprint !== '-') return false;
                if (sprint && sprint !== 'unassigned' && item.sprint !== sprint) return false;
                return true;
            });

            renderTable();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('sprintFilter').value = '';
            filteredData = [...backlogData];
            renderTable();
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };

            filteredData.sort((a, b) => {
                let aVal = a[column] || '';
                let bVal = b[column] || '';

                if (column === 'priority') {
                    aVal = priorityOrder[normalize(aVal)] ?? 99;
                    bVal = priorityOrder[normalize(bVal)] ?? 99;
                } else if (column === 'est_tokens') {
                    aVal = parseTokens(aVal);
                    bVal = parseTokens(bVal);
                } else if (column === 'id') {
                    aVal = parseInt(aVal.replace('BACKLOG-', '')) || 0;
                    bVal = parseInt(bVal.replace('BACKLOG-', '')) || 0;
                } else {
                    aVal = normalize(aVal);
                    bVal = normalize(bVal);
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            // Update header classes
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                if (th.dataset.sort === column) {
                    th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');

            tbody.innerHTML = filteredData.map(item => {
                const priority = normalize(item.priority);
                const status = normalize(item.status);

                return `
                    <tr>
                        <td><strong>${item.id}</strong></td>
                        <td>${item.title}</td>
                        <td>${item.category}</td>
                        <td><span class="priority-badge priority-${priority}">${item.priority}</span></td>
                        <td><span class="status-badge status-${status.replace(' ', '-')}">${item.status}</span></td>
                        <td>${item.sprint || '-'}</td>
                        <td>${item.est_tokens || '-'}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('resultCount').textContent = `${filteredData.length} of ${backlogData.length} items`;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backlog Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        header h1 {
            font-size: 2em;
        }

        .header-info {
            text-align: right;
            opacity: 0.9;
        }

        .filter-indicator {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            display: none;
        }

        .filter-indicator.active {
            display: inline-block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .metric-card.warning {
            border-left: 4px solid #f59e0b;
        }

        .metric-card.danger {
            border-left: 4px solid #ef4444;
        }

        .metric-card.success {
            border-left: 4px solid #10b981;
        }

        .metric-card.info {
            border-left: 4px solid #3b82f6;
        }

        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .metric-detail {
            font-size: 0.75em;
            color: #999;
            margin-top: 3px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin-bottom: 15px;
            color: #444;
            font-size: 1em;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .filters-header h3 {
            color: #444;
            font-size: 1em;
        }

        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 150px;
        }

        .filter-group.search {
            flex: 2;
            min-width: 250px;
        }

        .filter-group label {
            font-size: 0.8em;
            color: #666;
            font-weight: 500;
        }

        .filter-group select, .filter-group input {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
            transition: border-color 0.2s;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd6;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .table-header h3 {
            color: #444;
        }

        .result-count {
            color: #666;
            font-size: 0.9em;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th:hover {
            background: #e9ecef;
        }

        th.sorted-asc::after {
            content: ' ‚ñ≤';
            font-size: 0.7em;
        }

        th.sorted-desc::after {
            content: ' ‚ñº';
            font-size: 0.7em;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .priority-badge, .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-critical { background: #fee2e2; color: #dc2626; }
        .priority-high { background: #fef3c7; color: #d97706; }
        .priority-medium { background: #dbeafe; color: #2563eb; }
        .priority-low { background: #e5e7eb; color: #6b7280; }

        .status-pending { background: #e0e7ff; color: #4338ca; }
        .status-in-progress { background: #fef3c7; color: #d97706; }
        .status-testing { background: #d1fae5; color: #059669; }
        .status-completed { background: #d1fae5; color: #059669; }
        .status-blocked { background: #fee2e2; color: #dc2626; }
        .status-reopened { background: #fce7f3; color: #db2777; }
        .status-obsolete, .status-deferred { background: #e5e7eb; color: #6b7280; }

        .id-link {
            color: #667eea;
            font-weight: 600;
            text-decoration: none;
        }

        .id-link:hover {
            text-decoration: underline;
        }

        .estimate-cell {
            font-family: monospace;
            color: #666;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                text-align: center;
            }

            .header-info {
                text-align: center;
            }

            .filters-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>üìä Backlog Dashboard</h1>
                <span class="filter-indicator" id="filterIndicator">Filtered View</span>
            </div>
            <div class="header-info">
                <div id="generated-time"></div>
                <div style="font-size: 0.85em; opacity: 0.8;">Refresh page to update data</div>
            </div>
        </header>

        <div class="metrics-grid" id="metrics-grid"></div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìà Status Distribution</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>üéØ Priority Distribution</h3>
                <div class="chart-container">
                    <canvas id="priorityChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>üìÅ Category Distribution (Top 8)</h3>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>‚ö° Effort Distribution</h3>
                <div class="chart-container">
                    <canvas id="effortChart"></canvas>
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filters-header">
                <h3>üîç Filter Items</h3>
                <button class="btn btn-secondary" onclick="resetFilters()">Reset All</button>
            </div>
            <div class="filters-row">
                <div class="filter-group search">
                    <label>Search</label>
                    <input type="text" id="searchInput" placeholder="Search by ID, title, or category...">
                </div>
                <div class="filter-group">
                    <label>Status</label>
                    <select id="statusFilter">
                        <option value="">All Statuses</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Priority</label>
                    <select id="priorityFilter">
                        <option value="">All Priorities</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category</label>
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sprint</label>
                    <select id="sprintFilter">
                        <option value="">All</option>
                        <option value="unassigned">Unassigned Only</option>
                        <option value="assigned">Assigned Only</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h3>üìã Backlog Items</h3>
                <span class="result-count" id="resultCount"></span>
            </div>
            <div class="table-wrapper">
                <table id="backlogTable">
                    <thead>
                        <tr>
                            <th data-sort="id">ID</th>
                            <th data-sort="title">Title</th>
                            <th data-sort="category">Category</th>
                            <th data-sort="priority">Priority</th>
                            <th data-sort="status">Status</th>
                            <th data-sort="sprint">Sprint</th>
                            <th data-sort="est_tokens">Estimate</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Backlog data will be injected here
        const backlogData = BACKLOG_DATA_PLACEHOLDER;

        let currentSort = { column: 'id', direction: 'asc' };
        let filteredData = [...backlogData];

        // Chart instances (for updating)
        let statusChart, priorityChart, categoryChart, effortChart;

        // Colors
        const colors = {
            primary: '#667eea',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            info: '#3b82f6',
            gray: '#6b7280',
            purple: '#8b5cf6',
            pink: '#ec4899'
        };

        const statusColors = {
            'pending': '#818cf8',
            'completed': '#34d399',
            'in-progress': '#fbbf24',
            'testing': '#60a5fa',
            'blocked': '#f87171',
            'reopened': '#f472b6',
            'obsolete': '#94a3b8',
            'deferred': '#a1a1aa'
        };

        const priorityColors = {
            'critical': '#ef4444',
            'high': '#f59e0b',
            'medium': '#3b82f6',
            'low': '#6b7280'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generated-time').textContent = new Date().toLocaleString();

            populateFilters();
            renderAll();

            // Event listeners
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('priorityFilter').addEventListener('change', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('sprintFilter').addEventListener('change', applyFilters);

            // Sort headers
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => sortTable(th.dataset.sort));
            });
        });

        function normalize(val) {
            return (val || '').toLowerCase().trim().replace(/\*/g, '').replace(/_/g, '');
        }

        function parseTokens(val) {
            if (!val || val === '-') return 0;
            val = val.replace(/~/g, '').replace(/,/g, '').toUpperCase().trim();
            if (val.includes('-') && !val.startsWith('-')) val = val.split('-')[0];
            if (val.includes('K')) return parseFloat(val.replace('K', '')) * 1000 || 0;
            if (val.includes('M')) return parseFloat(val.replace('M', '')) * 1000000 || 0;
            return parseInt(val) || 0;
        }

        function formatTokens(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
            return num.toString();
        }

        function populateFilters() {
            const statuses = [...new Set(backlogData.map(i => normalize(i.status)))].filter(Boolean).sort();
            const priorities = ['critical', 'high', 'medium', 'low'];
            const categories = [...new Set(backlogData.map(i => normalize(i.category)))].filter(Boolean).sort();

            const statusSelect = document.getElementById('statusFilter');
            statuses.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s.charAt(0).toUpperCase() + s.slice(1);
                statusSelect.appendChild(opt);
            });

            const prioritySelect = document.getElementById('priorityFilter');
            priorities.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p;
                opt.textContent = p.charAt(0).toUpperCase() + p.slice(1);
                prioritySelect.appendChild(opt);
            });

            const categorySelect = document.getElementById('categoryFilter');
            categories.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                categorySelect.appendChild(opt);
            });
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const priority = document.getElementById('priorityFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const sprint = document.getElementById('sprintFilter').value;

            filteredData = backlogData.filter(item => {
                if (search) {
                    const searchFields = [item.id, item.title, item.category].join(' ').toLowerCase();
                    if (!searchFields.includes(search)) return false;
                }
                if (status && normalize(item.status) !== status) return false;
                if (priority && normalize(item.priority) !== priority) return false;
                if (category && normalize(item.category) !== category) return false;
                if (sprint === 'unassigned' && item.sprint && item.sprint !== '-') return false;
                if (sprint === 'assigned' && (!item.sprint || item.sprint === '-')) return false;
                return true;
            });

            // Update filter indicator
            const hasFilters = search || status || priority || category || sprint;
            document.getElementById('filterIndicator').classList.toggle('active', hasFilters);

            renderAll();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('sprintFilter').value = '';
            document.getElementById('filterIndicator').classList.remove('active');
            filteredData = [...backlogData];
            renderAll();
        }

        function renderAll() {
            renderMetrics();
            renderCharts();
            renderTable();
        }

        function renderMetrics() {
            const closed = ['completed', 'obsolete'];
            const total = filteredData.length;
            const open = filteredData.filter(i => !closed.includes(normalize(i.status)));
            const completed = filteredData.filter(i => normalize(i.status) === 'completed');
            const critical = filteredData.filter(i => normalize(i.priority) === 'critical' && !closed.includes(normalize(i.status)));
            const highPriority = filteredData.filter(i => ['critical', 'high'].includes(normalize(i.priority)) && !closed.includes(normalize(i.status)));
            const unassigned = open.filter(i => !i.sprint || i.sprint === '-');
            const blocked = filteredData.filter(i => normalize(i.status) === 'blocked');
            const reopened = filteredData.filter(i => normalize(i.status) === 'reopened');

            const totalEstimate = open.reduce((sum, i) => sum + parseTokens(i.est_tokens), 0);

            const metrics = [
                { value: total, label: 'Total Items', class: 'info', detail: `${open.length} open` },
                { value: completed.length, label: 'Completed', class: 'success', detail: `${((completed.length/backlogData.length)*100).toFixed(0)}% of all` },
                { value: critical.length, label: 'Critical', class: critical.length > 0 ? 'danger' : '', detail: 'Open critical items' },
                { value: highPriority.length, label: 'High Priority', class: highPriority.length > 20 ? 'warning' : '', detail: 'Critical + High' },
                { value: unassigned.length, label: 'Unassigned', class: '', detail: 'Not in any sprint' },
                { value: formatTokens(totalEstimate), label: 'Est. Effort', class: 'info', detail: 'Total tokens' },
            ];

            // Add attention items if present
            if (blocked.length > 0) {
                metrics.push({ value: blocked.length, label: 'Blocked', class: 'danger', detail: 'Needs attention' });
            }
            if (reopened.length > 0) {
                metrics.push({ value: reopened.length, label: 'Reopened', class: 'danger', detail: 'Failed testing' });
            }

            const grid = document.getElementById('metrics-grid');
            grid.innerHTML = metrics.map(m => `
                <div class="metric-card ${m.class}">
                    <div class="metric-value">${m.value}</div>
                    <div class="metric-label">${m.label}</div>
                    <div class="metric-detail">${m.detail}</div>
                </div>
            `).join('');
        }

        function renderCharts() {
            const closed = ['completed', 'obsolete'];
            const openItems = filteredData.filter(i => !closed.includes(normalize(i.status)));

            // Status Chart
            const statusCounts = {};
            filteredData.forEach(i => {
                const s = normalize(i.status) || 'unknown';
                statusCounts[s] = (statusCounts[s] || 0) + 1;
            });

            const statusLabels = Object.keys(statusCounts);
            const statusData = Object.values(statusCounts);
            const statusChartColors = statusLabels.map(s => statusColors[s] || '#94a3b8');

            if (statusChart) statusChart.destroy();
            statusChart = new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: statusLabels.map(s => s.charAt(0).toUpperCase() + s.slice(1)),
                    datasets: [{
                        data: statusData,
                        backgroundColor: statusChartColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12, padding: 10 } }
                    }
                }
            });

            // Priority Chart
            const priorityOrder = ['critical', 'high', 'medium', 'low'];
            const priorityCounts = { critical: 0, high: 0, medium: 0, low: 0 };
            openItems.forEach(i => {
                const p = normalize(i.priority);
                if (priorityCounts.hasOwnProperty(p)) priorityCounts[p]++;
            });

            if (priorityChart) priorityChart.destroy();
            priorityChart = new Chart(document.getElementById('priorityChart'), {
                type: 'bar',
                data: {
                    labels: priorityOrder.map(p => p.charAt(0).toUpperCase() + p.slice(1)),
                    datasets: [{
                        label: 'Items',
                        data: priorityOrder.map(p => priorityCounts[p]),
                        backgroundColor: priorityOrder.map(p => priorityColors[p])
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            // Category Chart
            const categoryCounts = {};
            openItems.forEach(i => {
                const c = normalize(i.category) || 'other';
                categoryCounts[c] = (categoryCounts[c] || 0) + 1;
            });
            const topCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);

            if (categoryChart) categoryChart.destroy();
            categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: topCategories.map(c => c[0]),
                    datasets: [{
                        label: 'Items',
                        data: topCategories.map(c => c[1]),
                        backgroundColor: colors.primary
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            // Effort Chart
            const effortBuckets = { 'Small (<20K)': 0, 'Medium (20-50K)': 0, 'Large (50-100K)': 0, 'XLarge (>100K)': 0, 'No estimate': 0 };
            openItems.forEach(i => {
                const tokens = parseTokens(i.est_tokens);
                if (tokens === 0) effortBuckets['No estimate']++;
                else if (tokens < 20000) effortBuckets['Small (<20K)']++;
                else if (tokens < 50000) effortBuckets['Medium (20-50K)']++;
                else if (tokens < 100000) effortBuckets['Large (50-100K)']++;
                else effortBuckets['XLarge (>100K)']++;
            });

            if (effortChart) effortChart.destroy();
            effortChart = new Chart(document.getElementById('effortChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(effortBuckets),
                    datasets: [{
                        data: Object.values(effortBuckets),
                        backgroundColor: [colors.success, colors.warning, '#f97316', colors.danger, colors.gray]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12, padding: 10 } }
                    }
                }
            });
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };

            filteredData.sort((a, b) => {
                let aVal = a[column] || '';
                let bVal = b[column] || '';

                if (column === 'priority') {
                    aVal = priorityOrder[normalize(aVal)] ?? 99;
                    bVal = priorityOrder[normalize(bVal)] ?? 99;
                } else if (column === 'est_tokens') {
                    aVal = parseTokens(aVal);
                    bVal = parseTokens(bVal);
                } else if (column === 'id') {
                    aVal = parseInt(aVal.replace('BACKLOG-', '')) || 0;
                    bVal = parseInt(bVal.replace('BACKLOG-', '')) || 0;
                } else {
                    aVal = normalize(aVal);
                    bVal = normalize(bVal);
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                if (th.dataset.sort === column) {
                    th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');

            tbody.innerHTML = filteredData.map(item => {
                const priority = normalize(item.priority);
                const status = normalize(item.status).replace(' ', '-');

                return `
                    <tr>
                        <td><span class="id-link">${item.id}</span></td>
                        <td>${item.title}</td>
                        <td>${item.category || '-'}</td>
                        <td><span class="priority-badge priority-${priority}">${item.priority || '-'}</span></td>
                        <td><span class="status-badge status-${status}">${item.status || '-'}</span></td>
                        <td>${item.sprint && item.sprint !== '-' ? item.sprint : '-'}</td>
                        <td class="estimate-cell">${item.est_tokens || '-'}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('resultCount').textContent =
                `Showing ${filteredData.length} of ${backlogData.length} items`;
        }
    </script>
</body>
</html>




































