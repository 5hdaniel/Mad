# EUM-018: Provisioning Status UI

## Task Info
- **Task ID:** EUM-018
- **Phase:** 4 - Automated Provisioning
- **Dependencies:** EUM-015 (Phase 3 complete)
- **Can Start:** After Phase 3 merge
- **Parallel With:** EUM-016, EUM-017, EUM-019

## Goal

Create a dashboard showing provisioning status, sync history, and error logs for SCIM operations.

## Non-Goals

- ❌ Real-time sync monitoring (websockets)
- ❌ Automated error retry
- ❌ User provisioning management (just viewing)
- ❌ Sync scheduling configuration
- ❌ Cross-organization provisioning stats
- ❌ Historical data archival

## Deliverables

1. Provisioning overview dashboard
2. Sync history list
3. Error log viewer
4. Manual sync trigger
5. User provisioning source indicators

## Component Structure

```
src/components/admin/provisioning/
├── ProvisioningStatus.tsx        # Main dashboard
├── ProvisioningOverview.tsx      # Stats cards
├── SyncHistory.tsx               # History list
├── ProvisioningErrors.tsx        # Error log
└── ManualSyncButton.tsx          # Trigger sync
```

## Key Features

1. **Overview Cards**
   - Total synced users
   - Pending syncs
   - Errors (last 24h)
   - Last sync time

2. **Sync History**
   - Timestamp
   - Operation (create/update/delete)
   - User affected
   - Status (success/failed)
   - Details

3. **Error Log**
   - Error timestamp
   - Operation attempted
   - Error message
   - Retry status

## Example Component

```tsx
// src/components/admin/provisioning/ProvisioningStatus.tsx
export function ProvisioningStatus() {
  const { orgId } = useParams();
  const [stats, setStats] = useState<ProvisioningStats | null>(null);
  const [history, setHistory] = useState<SyncEvent[]>([]);
  const [errors, setErrors] = useState<ProvisioningError[]>([]);

  return (
    <div className="space-y-6">
      <h2 className="text-xl font-semibold">Provisioning Status</h2>

      <ProvisioningOverview stats={stats} />

      <div className="grid grid-cols-2 gap-6">
        <div>
          <h3 className="font-medium mb-2">Recent Activity</h3>
          <SyncHistory events={history} />
        </div>
        <div>
          <h3 className="font-medium mb-2">Errors</h3>
          <ProvisioningErrors errors={errors} />
        </div>
      </div>
    </div>
  );
}
```

## Stats Interface

```typescript
interface ProvisioningStats {
  totalSynced: number;
  syncedViaScim: number;
  syncedViaSsoJit: number;
  syncedManually: number;
  pendingInvites: number;
  errorsLast24h: number;
  lastSyncAt: string | null;
}

interface SyncEvent {
  id: string;
  timestamp: string;
  operation: 'create' | 'update' | 'delete';
  userId: string;
  userEmail: string;
  status: 'success' | 'failed';
  details?: string;
}
```

## Files to Create

- `src/components/admin/provisioning/ProvisioningStatus.tsx`
- `src/components/admin/provisioning/ProvisioningOverview.tsx`
- `src/components/admin/provisioning/SyncHistory.tsx`
- `src/components/admin/provisioning/ProvisioningErrors.tsx`
- `electron/services/provisioningStatsService.ts`

## Dos

- ✅ Show clear breakdown by provisioning source
- ✅ Display errors prominently with actionable info
- ✅ Show last sync time for monitoring
- ✅ Paginate history for large datasets
- ✅ Auto-refresh data at reasonable intervals

## Don'ts

- ❌ Don't show raw error stack traces to users
- ❌ Don't aggregate stats from other organizations
- ❌ Don't allow modification from this dashboard
- ❌ Don't poll too frequently (respect rate limits)

## Acceptance Criteria

- [ ] Overview cards show accurate counts
- [ ] Breakdown by provisioning source (manual, SSO JIT, SCIM)
- [ ] Sync history shows recent operations with pagination
- [ ] Error log shows failures with useful details
- [ ] Last sync timestamp displayed
- [ ] Loading states appear during data fetches
- [ ] Empty states shown when no data
- [ ] Dashboard auto-refreshes at reasonable interval
- [ ] Unit tests cover main component rendering

## When to Stop and Ask

You MUST stop and ask the PM if:

1. **Stats calculation** - If stats aggregation needs optimization
2. **Error detail level** - If error messages need more/less detail
3. **History retention** - If history pagination needs limits
4. **Auto-refresh rate** - If refresh interval needs adjustment
5. **Manual sync trigger** - If manual sync should be visible here
6. **Error resolution** - If error acknowledgment/resolution is needed

Do NOT guess or make assumptions. Ask first.

## Integration Notes

### Dependencies
- **EUM-003**: Uses Audit Service to query provisioning events
- **EUM-002**: Uses Organization Service for member counts
- **EUM-004**: Uses RBAC (scim.view permission)

### For EUM-016 (SCIM Server)
- Stats derived from audit logs of SCIM events
- Error logs come from failed SCIM operations

### For EUM-020 (Final Integration)
- Dashboard added to admin navigation
- Should reflect real SCIM sync activity

### Stat Sources
- `totalSynced`: Count of org members with status=active
- `syncedViaScim`: Members where provisioned_by='scim'
- `syncedViaSsoJit`: Members where provisioned_by='sso_jit'
- `syncedManually`: Members where provisioned_by='manual'
- `errorsLast24h`: Audit logs with action starting with 'scim.' and error in details

## PR Preparation Checklist

- [ ] Dashboard shows accurate stats
- [ ] History displays correctly
- [ ] Errors shown clearly
- [ ] Unit tests written
- [ ] Type check passes

## Work Summary

### Branch Name
```
[FILL IN YOUR BRANCH NAME HERE]
```

### Changes Made
```
[LIST CHANGES]
```

### Testing Done
```
[DESCRIBE TESTING]
```

### PR Link
```
[LINK TO PR]
```
