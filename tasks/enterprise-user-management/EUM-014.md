# EUM-014: Audit Logs Viewer

## Task Info
- **Task ID:** EUM-014
- **Phase:** 3 - Admin Portal
- **Dependencies:** EUM-010 (Phase 2 complete)
- **Can Start:** After Phase 2 merge
- **Parallel With:** EUM-011, EUM-012, EUM-013

## Goal

Create a searchable, filterable audit log viewer with export functionality.

## Deliverables

1. Audit logs list with pagination
2. Filter by date range
3. Filter by action type
4. Filter by actor
5. Search functionality
6. Export to CSV
7. Log detail expansion

## Component Structure

```
src/components/admin/
â”œâ”€â”€ AuditLogs.tsx                 # Main container
â”œâ”€â”€ AuditLogFilters.tsx           # Filter controls
â”œâ”€â”€ AuditLogList.tsx              # Log entries list
â”œâ”€â”€ AuditLogEntry.tsx             # Individual log row
â”œâ”€â”€ AuditLogDetail.tsx            # Expanded detail view
â””â”€â”€ AuditLogExport.tsx            # Export button/modal
```

## Key Features

1. **Log Display**
   - Timestamp (relative + absolute on hover)
   - Action type with icon
   - Actor name/email
   - Resource affected
   - Expandable details

2. **Filters**
   - Date range picker
   - Action type dropdown (multi-select)
   - Actor search
   - Resource type filter

3. **Export**
   - CSV download
   - Date range selection for export
   - All columns included

## Example Component

```tsx
// src/components/admin/AuditLogs.tsx
export function AuditLogs() {
  const { orgId } = useParams<{ orgId: string }>();
  const [logs, setLogs] = useState<PaginatedAuditLogs | null>(null);
  const [filters, setFilters] = useState<AuditLogFilters>({});
  const [page, setPage] = useState(1);

  useEffect(() => {
    loadLogs();
  }, [orgId, filters, page]);

  const loadLogs = async () => {
    const result = await window.api.audit.getLogs(orgId!, filters, { page, pageSize: 50 });
    if (result.success) {
      setLogs(result.data);
    }
  };

  const handleExport = async () => {
    const result = await window.api.audit.export(orgId!, filters);
    if (result.success) {
      downloadCSV(result.data, `audit-logs-${Date.now()}.csv`);
    }
  };

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-xl font-semibold">Audit Logs</h2>
        <Button onClick={handleExport}>Export CSV</Button>
      </div>

      <AuditLogFilters filters={filters} onChange={setFilters} />

      <AuditLogList logs={logs?.logs || []} />

      <Pagination
        page={page}
        totalPages={logs?.totalPages || 1}
        onChange={setPage}
      />
    </div>
  );
}
```

## Action Type Icons

```tsx
const ACTION_ICONS = {
  'user.invited': 'ğŸ“¨',
  'user.removed': 'ğŸšª',
  'user.role_changed': 'ğŸ‘‘',
  'sso.configured': 'ğŸ”',
  'sso.enabled': 'âœ…',
  'scim.user_provisioned': 'ğŸ”„',
  // etc.
};
```

## Files to Create

- `src/components/admin/AuditLogs.tsx`
- `src/components/admin/AuditLogFilters.tsx`
- `src/components/admin/AuditLogList.tsx`
- `src/components/admin/AuditLogEntry.tsx`
- `src/components/admin/AuditLogDetail.tsx`
- `src/components/admin/__tests__/AuditLogs.test.tsx`

## PR Preparation Checklist

- [ ] Log list displays correctly
- [ ] All filters work
- [ ] Pagination works
- [ ] Export works
- [ ] Detail expansion works
- [ ] Unit tests written
- [ ] Type check passes

## Work Summary

### Branch Name
```
[FILL IN YOUR BRANCH NAME HERE]
```

### Changes Made
```
[LIST CHANGES]
```

### Testing Done
```
[DESCRIBE TESTING]
```

### PR Link
```
[LINK TO PR]
```
