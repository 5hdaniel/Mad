# EUM-010: SSO Integration & E2E Testing

## Task Info
- **Task ID:** EUM-010
- **Phase:** 2 - SSO Implementation (MERGE TASK)
- **Dependencies:** EUM-006, EUM-007, EUM-008, EUM-009
- **Can Start:** After all Phase 2 parallel tasks complete
- **Blocks:** All Phase 3 tasks

## Goal

Integrate all SSO services, update the authentication flow, register IPC handlers, and perform E2E testing with real Entra ID and Google Workspace tenants.

## Deliverables

1. All SSO services integrated and working together
2. Authentication flow updated to support SSO
3. IPC handlers registered for SSO operations
4. E2E tests with Entra ID
5. E2E tests with Google Workspace
6. SSO enforcement working
7. JIT provisioning working

## Technical Requirements

### 1. Register SSO Handlers

Update `electron/main.ts` to register SSO handlers.

### 2. Update Auth Flow

Modify the existing auth flow in `electron/auth-handlers.ts`:
- Check if user's email domain has SSO configured
- Redirect to SSO if enforced
- Handle SSO callback
- Complete JIT provisioning

### 3. Create SSO IPC Handlers

```typescript
// electron/handlers/ssoHandlers.ts
ipcMain.handle('sso:configure-entra', async (_, input) => { ... });
ipcMain.handle('sso:configure-google', async (_, input) => { ... });
ipcMain.handle('sso:test', async (_, orgId) => { ... });
ipcMain.handle('sso:enable', async (_, orgId, actorId) => { ... });
ipcMain.handle('sso:disable', async (_, orgId, actorId) => { ... });
ipcMain.handle('sso:set-enforcement', async (_, orgId, enforced, actorId) => { ... });
ipcMain.handle('sso:get-config', async (_, orgId) => { ... });
ipcMain.handle('sso:determine-login-method', async (_, request) => { ... });
ipcMain.handle('sso:complete-login', async (_, provider, code, state) => { ... });
```

### 4. Update Preload Bridge

Add SSO API to `electron/preload.ts`.

### 5. E2E Test Scenarios

**Entra ID Tests:**
- [ ] Configure SSO with valid Entra ID credentials
- [ ] Test configuration succeeds
- [ ] Enable SSO
- [ ] Login with Entra ID account
- [ ] JIT provisioning creates new user
- [ ] Existing user is recognized
- [ ] Wrong tenant is rejected
- [ ] SSO enforcement blocks standard login

**Google Workspace Tests:**
- [ ] Configure SSO with valid Google credentials
- [ ] Test configuration succeeds
- [ ] Enable SSO
- [ ] Login with Workspace account
- [ ] Wrong domain is rejected
- [ ] SSO enforcement works

## Verification Checklist

- [ ] All services integrated
- [ ] Auth flow updated
- [ ] E2E: Entra ID OIDC flow works
- [ ] E2E: Google Workspace OIDC flow works
- [ ] SSO enforcement blocks non-SSO login
- [ ] JIT provisioning creates users
- [ ] Domain verification working
- [ ] Error states handled gracefully
- [ ] Logout flow works

## Files to Modify

- `electron/main.ts` - Register handlers
- `electron/auth-handlers.ts` - Add SSO support
- `electron/preload.ts` - Add SSO API

## Files to Create

- `electron/handlers/ssoHandlers.ts`
- `electron/__tests__/e2e/sso.e2e.test.ts`

## PR Preparation Checklist

- [ ] All Phase 2 tasks merged
- [ ] E2E tests passing
- [ ] Type check passes
- [ ] Lint check passes
- [ ] Manual testing complete

## Work Summary

### Branch Name
```
[FILL IN YOUR BRANCH NAME HERE]
```

### Changes Made
```
[LIST CHANGES]
```

### Testing Done
```
[DESCRIBE E2E TESTING]
```

### PR Link
```
[LINK TO PR]
```
