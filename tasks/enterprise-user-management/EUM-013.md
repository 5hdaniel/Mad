# EUM-013: SSO Configuration Wizard

## Task Info
- **Task ID:** EUM-013
- **Phase:** 3 - Admin Portal
- **Dependencies:** EUM-010 (Phase 2 complete)
- **Can Start:** After Phase 2 merge
- **Parallel With:** EUM-011, EUM-012, EUM-014

## Goal

Create a step-by-step wizard for configuring SSO with Microsoft Entra ID or Google Workspace.

## Non-Goals

- ❌ Implementing SSO backend services (handled in Phase 2)
- ❌ Managing team members (handled in EUM-012)
- ❌ Organization settings (handled in EUM-011)
- ❌ SCIM token management (handled in Phase 4)
- ❌ Custom SAML configuration
- ❌ Multiple SSO provider support per org

## Deliverables

1. Provider selection screen
2. Step-by-step configuration wizard
3. Entra ID setup flow
4. Google Workspace setup flow
5. Test connection functionality
6. Enable/disable SSO controls
7. SSO enforcement toggle

## Component Structure

```
src/components/admin/sso/
├── SSOConfiguration.tsx          # Main container
├── ProviderSelector.tsx          # Choose Entra ID or Google
├── EntraIdWizard.tsx             # Entra ID setup steps
├── GoogleWorkspaceWizard.tsx     # Google setup steps
├── SSOTestConnection.tsx         # Test button & results
├── SSOStatus.tsx                 # Current SSO status display
└── SSOEnforcementToggle.tsx      # Enforcement setting
```

## Wizard Steps

### Entra ID Flow
1. **Provider Selection** - Choose Microsoft Entra ID
2. **Azure Setup Instructions** - Step-by-step guide with screenshots
3. **Enter Configuration** - Tenant ID, Client ID, Client Secret
4. **Test Connection** - Validate configuration
5. **Enable SSO** - Activate SSO login

### Google Workspace Flow
1. **Provider Selection** - Choose Google Workspace
2. **Google Setup Instructions** - Step-by-step guide
3. **Enter Configuration** - Domain, Client ID, Client Secret
4. **Test Connection** - Validate configuration
5. **Enable SSO** - Activate SSO login

## Example Component

```tsx
// src/components/admin/sso/SSOConfiguration.tsx
export function SSOConfiguration() {
  const { orgId } = useParams<{ orgId: string }>();
  const [config, setConfig] = useState<SSOConfiguration | null>(null);
  const [wizardStep, setWizardStep] = useState<'select' | 'configure' | 'test' | 'enable'>('select');

  if (config?.isActive) {
    return <SSOStatus config={config} onDisable={handleDisable} />;
  }

  return (
    <div className="space-y-6">
      <h2 className="text-xl font-semibold">Configure SSO</h2>

      {wizardStep === 'select' && (
        <ProviderSelector onSelect={handleProviderSelect} />
      )}

      {wizardStep === 'configure' && selectedProvider === 'entra_id' && (
        <EntraIdWizard onComplete={handleConfigComplete} />
      )}

      {wizardStep === 'configure' && selectedProvider === 'google_workspace' && (
        <GoogleWorkspaceWizard onComplete={handleConfigComplete} />
      )}

      {wizardStep === 'test' && (
        <SSOTestConnection orgId={orgId!} onSuccess={() => setWizardStep('enable')} />
      )}

      {wizardStep === 'enable' && (
        <EnableSSOStep orgId={orgId!} onEnabled={loadConfig} />
      )}
    </div>
  );
}
```

## Provider Setup Instructions Content

Include in the wizard:
- Screenshots of Azure Portal / Google Cloud Console
- Copy-paste friendly configuration values
- Links to provider documentation
- Troubleshooting tips

## Files to Create

- `src/components/admin/sso/SSOConfiguration.tsx`
- `src/components/admin/sso/ProviderSelector.tsx`
- `src/components/admin/sso/EntraIdWizard.tsx`
- `src/components/admin/sso/GoogleWorkspaceWizard.tsx`
- `src/components/admin/sso/SSOTestConnection.tsx`
- `src/components/admin/sso/SSOStatus.tsx`
- `src/components/admin/sso/SSOEnforcementToggle.tsx`
- `src/components/admin/sso/__tests__/SSOConfiguration.test.tsx`

## Dos

- ✅ Provide clear step-by-step instructions with visuals
- ✅ Show test connection status prominently
- ✅ Require successful test before enabling
- ✅ Warn about enforcement implications
- ✅ Allow reconfiguration after initial setup

## Don'ts

- ❌ Don't allow enabling SSO without successful test
- ❌ Don't store client secrets in browser storage
- ❌ Don't show client secrets after initial entry
- ❌ Don't allow enforcement without SSO enabled

## Acceptance Criteria

- [ ] Provider selection shows Entra ID and Google Workspace options
- [ ] Entra ID wizard guides through all configuration steps
- [ ] Google Workspace wizard guides through all configuration steps
- [ ] Setup instructions are clear with copy-able values
- [ ] Configuration form validates required fields
- [ ] Test connection shows pass/fail with error details
- [ ] Enable SSO only works after successful test
- [ ] SSO status displays current configuration
- [ ] Disable SSO works with confirmation
- [ ] Enforcement toggle warns about implications
- [ ] Can reconfigure after initial setup
- [ ] Unit tests cover wizard flow

## When to Stop and Ask

You MUST stop and ask the PM if:

1. **Setup instructions accuracy** - If Azure/Google setup steps need verification
2. **Provider-specific features** - If provider-specific options are needed
3. **Enforcement warning** - If enforcement messaging needs legal review
4. **Reconfiguration flow** - If changing providers after setup is unclear
5. **Test connection failures** - If error messages need more detail
6. **Secret handling** - If client secret UI pattern is unclear

Do NOT guess or make assumptions. Ask first.

## Integration Notes

### Dependencies
- **EUM-008**: Uses SSO Core Service for configuration and testing
- **EUM-004**: Uses RBAC Service for permission checks

### For EUM-015 (Integration Task)
- Component must work within AdminLayout
- Must respond to route params (`orgId`)
- Test connection may take several seconds

### Setup Documentation Assets
- Include screenshots or placeholders for Azure Portal steps
- Include screenshots or placeholders for Google Cloud Console steps
- Make instructions copy-paste friendly

## PR Preparation Checklist

- [ ] Both provider flows working
- [ ] Setup instructions clear
- [ ] Test connection works
- [ ] Enable/disable works
- [ ] Enforcement toggle works
- [ ] Unit tests written
- [ ] Type check passes

## Work Summary

### Branch Name
```
[FILL IN YOUR BRANCH NAME HERE]
```

### Changes Made
```
[LIST CHANGES]
```

### Testing Done
```
[DESCRIBE TESTING]
```

### PR Link
```
[LINK TO PR]
```
